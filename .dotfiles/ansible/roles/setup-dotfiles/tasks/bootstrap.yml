- block:
    - name: install git
      pacman: name=git
    - name: install tcl
      pacman: name=tcl
  become: yes
  become_user: root

- name: initialize dotfiles for {{ home }}
  command: git --git-dir="{{ git_dir }}" init
  args:
    creates: "{{ git_dir }}"
    chdir: "{{ home }}"

- name: check if remote exists
  command: git --git-dir="{{ git_dir }}" --work-tree="{{ home }}" remote
  register: dotfiles
  changed_when: dotfiles.stdout != "origin"

- name: add the dotfiles remote url
  command: git --git-dir="{{ git_dir }}" --work-tree="{{ home }}" remote add origin "{{ thirdparty }}/dotfiles"
  when: dotfiles.stdout == ""

- name: fetch dotfiles
  command: git --git-dir="{{ git_dir }}" --work-tree="{{ home }}" fetch
  changed_when: dotfiles.stderr != ""

- name: checkout master
  command: git --git-dir="{{ git_dir }}" --work-tree="{{ home }}" checkout --force master
  changed_when: dotfiles.stdout != "Your branch is up to date with 'origin/master'."

- name: set local master to track remote master branch
  command: git --git-dir="{{ git_dir }}" --work-tree="{{ home }}" branch --set-upstream-to=origin/master master
