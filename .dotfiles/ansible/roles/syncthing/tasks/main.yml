- name: syncthing - add apt key
  apt_key:
    url: https://syncthing.net/release-key.txt
    state: present
  become: yes

- name: syncthing - add apt repository
  apt_repository:
    repo: deb https://apt.syncthing.net/ syncthing stable
  become: yes

- name: syncthing - install packages
  include_role:
    name: apt-install
  vars:
    apt_packages:
      - syncthing

- name: dotfiles - copy syncthing service file
  copy:
    src: "{{ thirdparty }}/syncthing/etc/linux-systemd/user/syncthing.service"
    dest: "{{ ansible_env.HOME }}/.config/systemd/user/syncthing.service"
    mode: 0700

- name: dotfiles - enable syncthing service
  systemd:
    name: syncthing
    enabled: yes
    masked: no
    scope: user
    state: started
