- name: delete xkb_switch build folder
  file:
    state: absent
    path: "{{ thirdparty }}/xkb_switch-git/build"

- name: create xkb_switch build folder
  file:
    state: directory
    path: "{{ thirdparty }}/xkb_switch-git/build"

- name: configure xkb_switch
  command: cmake ..
  args:
    chdir: "{{ thirdparty }}/xkb_switch-git/build"

- name: compile xkb_switch
  command: make
  args:
    chdir: "{{ thirdparty }}/xkb_switch-git/build"

- name: install xkb_switch
  command: make install
  args:
    chdir: "{{ thirdparty }}/xkb_switch-git/build"
  become: true

- name: copy xkb_switch binary
  copy:
    src: "{{ thirdparty }}/xkb_switch-git/build/xkb-switch"
    dest: "{{ ansible_env.HOME }}/.local/bin"
    mode: 0700
